var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,d=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&o(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&o(e,a,t[a]);return e},n=(e,l)=>t(e,a(l));import{y as i,bs as u,bu as c,d as m,r as p,x as b,b as f,c as y,z as h,Q as v,br as w,h as I,t as k,A as g,aH as C,e as T,C as x,bz as P,a7 as _,bY as $,bZ as j,bh as O}from"./vendor.75aebe02.js";/* empty css              */import{D as q}from"./dynamic-table.60ab9d56.js";import{u as M}from"./useFormModal.48bf546c.js";/* empty css               */import{y as z,O as S}from"./index.cbbca19b.js";const R=e=>{switch(e){case 0:return"#d9d9d9";case 1:return"#52c41a"}},V=e=>{switch(e){case 0:return"停止";case 1:return"运行"}},D=[{title:"任务名称",dataIndex:"name",width:240},{title:"状态",width:120,dataIndex:"status",align:"center",bodyCell:({record:e})=>i(u,{status:1===e.status?"processing":"default",color:R(e.status),text:V(e.status)},null)},{title:"类型",width:100,align:"center",dataIndex:"type",bodyCell:({record:e})=>i(c,{color:"processing"},{default:()=>[1===e.type?"Interval":"Cron"]})},{title:"调用服务",dataIndex:"service",hideInSearch:!0,align:"center",width:350},{title:"执行参数",dataIndex:"data",align:"center",hideInSearch:!0,width:450},{title:"备注",width:250,align:"center",dataIndex:"remark"}],F=[{field:"type",component:"RadioGroup",label:"名称",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"Cron",value:0},{label:"时间间隔",value:1}]}},{field:"name",component:"Input",label:"任务名称",rules:[{required:!0,type:"string"}]},{field:"service",component:"Input",label:"服务路径",rules:[{required:!0,type:"string"}],componentProps:{placeholder:"请输入调用服务的路径"}},{field:"data",component:"Input",label:"任务参数",componentProps:{placeholder:"请输入任务参数（可不填）"}},{field:"limit",component:"InputNumber",label:"执行次数",defaultValue:-1,componentProps:{min:-1,style:{width:"100%"}}},{field:"cron",component:"Input",label:"Cron",rules:[{required:!0,type:"string"}],vIf:({formModel:e})=>0===e.type,componentProps:{placeholder:"请输入Cron表达式"}},{field:"every",component:"InputNumber",label:"执行间隔",defaultValue:6e4,vIf:({formModel:e})=>1===e.type,rules:[{required:!0,type:"number"}],componentProps:{min:100,style:{width:"100%"}}},{field:"startTime",component:"DatePicker",label:"开始时间",vIf:({formModel:e})=>0===e.type,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"endTime",component:"DatePicker",label:"结束时间",vIf:({formModel:e})=>0===e.type,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",defaultValue:1,label:"状态",componentProps:{options:[{label:"运行",value:1},{label:"停止",value:0}]}}];function A(e){return z({url:S.page,method:"get",params:e})}function G(e){return z({url:S.add,method:"post",data:e},{successMsg:"添加成功"})}function N(e){return z({url:S.update,method:"post",data:e},{successMsg:"修改成功"})}const E=I(" 新增 "),H=I("秒 分 小时 日期 月份 星期 年(可选)"),Q=I("仅一次 "),W=I("运行 "),Y=I("停止 "),Z=m(n(d({},{name:"SystemScheduleTask"}),{setup(e){const t=p(),[a]=M(),l=()=>{var e;return null==(e=t.value)?void 0:e.refreshTable()},s=async e=>{var t;const[s]=await a({modalProps:{title:(e.id?"编辑":"新增")+"任务",width:640,onFinish:async t=>{const a=n(d({},t),{id:e.id});await(e.id?N:G)(a),l()}},formSchema:{labelWidth:100,layout:"vertical",schemas:F}});if(e.id){const a=await(r={id:e.id},z({url:S.info,method:"get",params:r}));null==(t=s.value)||t.setFieldsValue(d(d({},e),a))}var r},r=async e=>{var t;await(t={id:e},z({url:S.delete,method:"post",data:t})),l()},o=async e=>{var t;await(t={id:e.id},z({url:S.once,method:"post",data:t})),l()},u=async e=>{var t;await(t={id:e.id},z({url:S.start,method:"post",data:t})),l()},c=async e=>{var t;await(t={id:e.id},z({url:S.stop,method:"post",data:t})),l()},m=e=>e.startTime||e.endTime?!e.startTime&&e.endTime?`无开始时间限制 - ${e.endTime}`:e.startTime&&!e.endTime?`${e.startTime} - 长期有效`:`${e.startTime} - ${e.endTime}`:"无时段限制",R=[...D,{title:"操作",width:220,dataIndex:"$action",align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.task.update",effect:"disable"},onClick:()=>s(e)},{label:"删除",auth:"sys.task.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>r(e.id)}}]}];return(e,a)=>{const l=b("a-button");return f(),y("div",null,[i(v(q),{ref_key:"dynamicTableRef",ref:t,"row-key":"id","header-title":"定时任务",search:!1,"data-request":v(A),columns:R,scroll:{x:2e3},bordered:"",size:"small"},{toolbar:h((()=>[i(l,{type:"primary",disabled:!e.$auth("sys.task.add"),onClick:a[0]||(a[0]=e=>s({}))},{default:h((()=>[E])),_:1},8,["disabled"])])),expandedRowRender:h((({record:t})=>[i(v(w),{column:1},{default:h((()=>[i(v(w).Item,{label:"任务编号"},{default:h((()=>[I("# "+k(t.id),1)])),_:2},1024),i(v(w).Item,{label:"执行次数"},{default:h((()=>[I(k(t.limit>0?`仅 ${t.limit} 次`:"无次数限制"),1)])),_:2},1024),1===t.type?(f(),g(v(w).Item,{key:0,label:"执行间隔"},{default:h((()=>[I(" 每"+k(t.every)+"毫秒执行一次 ",1)])),_:2},1024)):(f(),g(v(w).Item,{key:1,label:"Cron表达式"},{default:h((()=>[i(v(C),null,{title:h((()=>[H])),default:h((()=>[I(" "+k(t.cron),1)])),_:2},1024)])),_:2},1024)),0===t.type?(f(),g(v(w).Item,{key:2,label:"执行时间段"},{default:h((()=>[T("span",null,k(m(t)),1)])),_:2},1024)):x("",!0),i(v(w).Item,{label:"执行操作"},{default:h((()=>[i(v(P),{title:"确认手动执行一次该任务吗?",disabled:!e.$auth("sys.task.once"),onConfirm:e=>o(t)},{default:h((()=>[i(v(_),{type:"link",size:"small",disabled:!e.$auth("sys.task.once")},{icon:h((()=>[i(v($))])),default:h((()=>[Q])),_:1},8,["disabled"])])),_:2},1032,["disabled","onConfirm"]),i(v(P),{title:"确认运行该任务吗?",disabled:!(e.$auth("sys.task.start")&&0===t.status),onConfirm:e=>u(t)},{default:h((()=>[i(v(_),{type:"link",size:"small",disabled:!(e.$auth("sys.task.start")&&0===t.status)},{icon:h((()=>[i(v(j))])),default:h((()=>[W])),_:2},1032,["disabled"])])),_:2},1032,["disabled","onConfirm"]),i(v(P),{title:"确认停止该任务吗?",disabled:!(e.$auth("sys.task.stop")&&1===t.status),onConfirm:e=>c(t)},{default:h((()=>[i(v(_),{type:"link",size:"small",disabled:!(e.$auth("sys.task.stop")&&1===t.status)},{icon:h((()=>[i(v(O))])),default:h((()=>[Y])),_:2},1032,["disabled"])])),_:2},1032,["disabled","onConfirm"])])),_:2},1024)])),_:2},1024)])),_:1},8,["data-request"])])}}}));export{Z as default};
